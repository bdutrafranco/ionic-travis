language: node_js
node_js:
  - '8'

notifications:
  email: 
    recipients:
      - brunodutrafranco@id.uff.br
    on_success: always

matrix:
  include:
  - os: linux
    sudo: false
    language: android
    android:
      components:
        - build-tools-27.0.3
        - android-27
        - add-on
        - extra
      licenses:
        - 'android-sdk-preview-license-52d11cd2'
        - 'android-sdk-license-.+'
        - 'google-gdk-license-.+'
    addons:
      apt:
        sources:
        - sourceline: deb https://dl.yarnpkg.com/debian/ stable main
          key_url: https://dl.yarnpkg.com/debian/pubkey.gpg
        - sourceline: deb http://dl.google.com/linux/chrome/deb/ stable main
          key_url: https://dl-ssl.google.com/linux/linux_signing_key.pub
        packages:
          - oracle-java8-installer
          - oracle-java8-set-default
          - yarn
          - jq
          - gradle
          - google-chrome-stable
  
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -f  $HOME/.gradle/caches/transforms-1/transforms-1.lock
  - rm -rf $HOME/.gradle/caches/3.5/fileHashes/
  - rm -rf $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
    - ./node_modules

before_install: 
  - export LANG=pt_BR.UTF-8
  - export CHROME_BIN=google-chrome
  - export TRAVIS_TAG=$(git tag --points-at HEAD)
  - nvm install 9
  - yarn global add ionic cordova
  - yes | sdkmanager "platforms;android-27"  

  install:
  - npm install

script:
  - ./travis/build.sh

deploy:
  provider: releases
  github-token: $GITHUB_TOKEN
  file_glob: true
  file: "/home/travis/build/$TRAVIS_REPO_SLUG/platforms/android/app/build/outputs/apk/*/*.apk"
  skip_cleanup: true
  on:
    repo: $TRAVIS_REPO_SLUG
    all_branches: true
    tags: true
env:
  global:
  - JAVA_HOME=/usr/lib/jvm/java-8-oracle